 الخطوة1  : تنصيب برنامج ssms2019 

 الخطوة 2 : تسجيل كحساب local 

الخطوة 3 :  بعد انشاء للبداية نضغط على يمين على database -> new database 
 نسميه DB2_MiniProject

الخطوة 4 : بعد الانشاء نضغط يمين على الداتا بيز الذي قمنا بانشاءه ونضغط على new query 
بعدها ننسخ ما يلي على الكويري 



CREATE TABLE Institution (
    InstitutionID INT IDENTITY PRIMARY KEY,
    Name NVARCHAR(200) NOT NULL,
    Code NVARCHAR(50),
    Address NVARCHAR(300),
    Phone NVARCHAR(50),
    CreatedAt DATETIME2 DEFAULT SYSDATETIME(),
    IsActive BIT DEFAULT 1
);

CREATE TABLE Department (
    DepartmentID INT IDENTITY PRIMARY KEY,
    InstitutionID INT NOT NULL,
    Name NVARCHAR(200) NOT NULL,
    ManagerEmployeeID INT NULL,
    CreatedAt DATETIME2 DEFAULT SYSDATETIME(),
    IsActive BIT DEFAULT 1,
    CONSTRAINT FK_Department_Institution
        FOREIGN KEY (InstitutionID)
        REFERENCES Institution(InstitutionID)
);

CREATE TABLE Section (
    SectionID INT IDENTITY PRIMARY KEY,
    DepartmentID INT NOT NULL,
    Name NVARCHAR(200) NOT NULL,
    CreatedAt DATETIME2 DEFAULT SYSDATETIME(),
    IsActive BIT DEFAULT 1,
    CONSTRAINT FK_Section_Department
        FOREIGN KEY (DepartmentID)
        REFERENCES Department(DepartmentID)
);

CREATE TABLE Employee (
    EmployeeID INT IDENTITY PRIMARY KEY,
    SectionID INT NULL,
    FullName NVARCHAR(200) NOT NULL,
    Username NVARCHAR(100) UNIQUE,
    Email NVARCHAR(200),
    Phone NVARCHAR(50),
    Position NVARCHAR(100),
    HireDate DATE,
    IsActive BIT DEFAULT 1,
    RowVersion ROWVERSION,
    CONSTRAINT FK_Employee_Section
        FOREIGN KEY (SectionID)
        REFERENCES Section(SectionID)
);

/* =========================================================
   ROLES & AUTHORIZATION
========================================================= */

CREATE TABLE Role (
    RoleID INT IDENTITY PRIMARY KEY,
    Name NVARCHAR(100) NOT NULL,
    Description NVARCHAR(300)
);

CREATE TABLE UserRole (
    UserRoleID INT IDENTITY PRIMARY KEY,
    EmployeeID INT NOT NULL,
    RoleID INT NOT NULL,
    AssignedAt DATETIME2 DEFAULT SYSDATETIME(),
    CONSTRAINT FK_UserRole_Employee
        FOREIGN KEY (EmployeeID)
        REFERENCES Employee(EmployeeID),
    CONSTRAINT FK_UserRole_Role
        FOREIGN KEY (RoleID)
        REFERENCES Role(RoleID)
);

/* =========================================================
   LOOKUP TABLES
========================================================= */

CREATE TABLE RequestType (
    RequestTypeID INT IDENTITY PRIMARY KEY,
    Name NVARCHAR(100) NOT NULL,
    Description NVARCHAR(300)
);

CREATE TABLE RequestStatus (
    RequestStatusID INT IDENTITY PRIMARY KEY,
    Code NVARCHAR(50) UNIQUE,
    Name NVARCHAR(100),
    IsFinal BIT DEFAULT 0
);

CREATE TABLE Priority (
    PriorityID INT IDENTITY PRIMARY KEY,
    Level INT,
    Name NVARCHAR(50)
);

/* =========================================================
   REQUESTS
========================================================= */

CREATE TABLE Requests (
    RequestID INT IDENTITY PRIMARY KEY,
    RequestNumber NVARCHAR(50) UNIQUE,
    CreatedBy INT NOT NULL,
    RequestTypeID INT NOT NULL,
    PriorityID INT NOT NULL,
    CurrentReviewerID INT NULL,
    Title NVARCHAR(300),
    Content NVARCHAR(MAX),
    Status NVARCHAR(50),
    CreatedAt DATETIME2 DEFAULT SYSDATETIME(),
    DueDate DATETIME2 NULL,
    ClosedAt DATETIME2 NULL,
    IsEscalated BIT DEFAULT 0,
    ParentRequestID INT NULL,
    RowVersion ROWVERSION,
    CONSTRAINT FK_Requests_Creator
        FOREIGN KEY (CreatedBy)
        REFERENCES Employee(EmployeeID),
    CONSTRAINT FK_Requests_Type
        FOREIGN KEY (RequestTypeID)
        REFERENCES RequestType(RequestTypeID),
    CONSTRAINT FK_Requests_Priority
        FOREIGN KEY (PriorityID)
        REFERENCES Priority(PriorityID),
    CONSTRAINT FK_Requests_Reviewer
        FOREIGN KEY (CurrentReviewerID)
        REFERENCES Employee(EmployeeID),
    CONSTRAINT FK_Requests_Parent
        FOREIGN KEY (ParentRequestID)
        REFERENCES Requests(RequestID)
);

/* =========================================================
   REQUEST DETAILS
========================================================= */

CREATE TABLE RequestHistory (
    HistoryID INT IDENTITY PRIMARY KEY,
    RequestID INT NOT NULL,
    FromEmployeeID INT NULL,
    ToEmployeeID INT NULL,
    Action NVARCHAR(100),
    ActionDate DATETIME2 DEFAULT SYSDATETIME(),
    Notes NVARCHAR(MAX),
    CONSTRAINT FK_History_Request
        FOREIGN KEY (RequestID)
        REFERENCES Requests(RequestID)
);

CREATE TABLE RequestNotes (
    NoteID INT IDENTITY PRIMARY KEY,
    RequestID INT NOT NULL,
    EmployeeID INT NOT NULL,
    NoteText NVARCHAR(MAX),
    NoteDate DATETIME2 DEFAULT SYSDATETIME(),
    CONSTRAINT FK_Notes_Request
        FOREIGN KEY (RequestID)
        REFERENCES Requests(RequestID),
    CONSTRAINT FK_Notes_Employee
        FOREIGN KEY (EmployeeID)
        REFERENCES Employee(EmployeeID)
);

CREATE TABLE RequestReviewer (
    ReviewerID INT IDENTITY PRIMARY KEY,
    RequestID INT NOT NULL,
    EmployeeID INT NOT NULL,
    Sequence INT,
    Status NVARCHAR(50),
    DecisionDate DATETIME2 NULL,
    Comments NVARCHAR(MAX),
    CONSTRAINT FK_Reviewer_Request
        FOREIGN KEY (RequestID)
        REFERENCES Requests(RequestID),
    CONSTRAINT FK_Reviewer_Employee
        FOREIGN KEY (EmployeeID)
        REFERENCES Employee(EmployeeID)
);

/* =========================================================
   FILES & ATTACHMENTS
========================================================= */

CREATE TABLE Attachments (
    AttachmentID INT IDENTITY PRIMARY KEY,
    RequestID INT NOT NULL,
    FileName NVARCHAR(200),
    FilePath NVARCHAR(500),
    MimeType NVARCHAR(100),
    Size INT,
    UploadedBy INT,
    UploadedAt DATETIME2 DEFAULT SYSDATETIME(),
    CONSTRAINT FK_Attachments_Request
        FOREIGN KEY (RequestID)
        REFERENCES Requests(RequestID)
);

CREATE TABLE Documents (
    DocumentID INT IDENTITY PRIMARY KEY,
    RequestID INT NOT NULL,
    FileName NVARCHAR(200),
    Version INT,
    FilePath NVARCHAR(500),
    UploadedBy INT,
    UploadedAt DATETIME2 DEFAULT SYSDATETIME(),
    Notes NVARCHAR(300),
    CONSTRAINT FK_Documents_Request
        FOREIGN KEY (RequestID)
        REFERENCES Requests(RequestID)
);

/* =========================================================
   SYSTEM SUPPORT
========================================================= */

CREATE TABLE AuditLog (
    AuditID INT IDENTITY PRIMARY KEY,
    TableName NVARCHAR(100),
    OperationType NVARCHAR(20),
    KeyValue NVARCHAR(100),
    ChangedBy NVARCHAR(100),
    ChangedAt DATETIME2 DEFAULT SYSDATETIME(),
    Details NVARCHAR(MAX)
);

CREATE TABLE WorkflowStep (
    StepID INT IDENTITY PRIMARY KEY,
    RequestTypeID INT NOT NULL,
    Name NVARCHAR(100),
    Sequence INT,
    AutoAction NVARCHAR(100),
    SLAHours INT,
    CONSTRAINT FK_Workflow_RequestType
        FOREIGN KEY (RequestTypeID)
        REFERENCES RequestType(RequestTypeID)
);

CREATE TABLE Escalation (
    EscalationID INT IDENTITY PRIMARY KEY,
    RequestID INT NOT NULL,
    EscalatedAt DATETIME2 DEFAULT SYSDATETIME(),
    EscalatedToEmployeeID INT,
    Reason NVARCHAR(300),
    ResolvedAt DATETIME2 NULL,
    CONSTRAINT FK_Escalation_Request
        FOREIGN KEY (RequestID)
        REFERENCES Requests(RequestID)
);

CREATE TABLE Notification (
    NotificationID INT IDENTITY PRIMARY KEY,
    RequestID INT NOT NULL,
    RecipientEmployeeID INT NOT NULL,
    Channel NVARCHAR(50),
    Message NVARCHAR(MAX),
    SentAt DATETIME2 DEFAULT SYSDATETIME(),
    Status NVARCHAR(50),
    CONSTRAINT FK_Notification_Request
        FOREIGN KEY (RequestID)
        REFERENCES Requests(RequestID)
);

CREATE TABLE Tag (
    TagID INT IDENTITY PRIMARY KEY,
    Name NVARCHAR(50),
    Color NVARCHAR(20)
);

CREATE TABLE RequestTag (
    RequestTagID INT IDENTITY PRIMARY KEY,
    RequestID INT NOT NULL,
    TagID INT NOT NULL,
    CONSTRAINT FK_RequestTag_Request
        FOREIGN KEY (RequestID)
        REFERENCES Requests(RequestID),
    CONSTRAINT FK_RequestTag_Tag
        FOREIGN KEY (TagID)
        REFERENCES Tag(TagID)
);

CREATE TABLE SLA (
    SLAID INT IDENTITY PRIMARY KEY,
    RequestTypeID INT NOT NULL,
    ResponseHours INT,
    ResolveHours INT,
    CONSTRAINT FK_SLA_RequestType
        FOREIGN KEY (RequestTypeID)
        REFERENCES RequestType(RequestTypeID)
);

CREATE TABLE Queue (
    QueueID INT IDENTITY PRIMARY KEY,
    Name NVARCHAR(100),
    Description NVARCHAR(300),
    OwnerEmployeeID INT,
    CONSTRAINT FK_Queue_Employee
        FOREIGN KEY (OwnerEmployeeID)
        REFERENCES Employee(EmployeeID)
);

ونحدد الكل ونقوم بعمل execute  
تاكدو من انو الشغل صح منفوت عالtables   ومنشوف كل اللي سويناه بقلبو 
بدو يطلع معنا 23 واحد 


الخطوة 5 : ندخل الى داتا بيز داياغرام ويمين عليه 

new databasse diagram

add all tables one by one 

 وبس نخلص   منحط اوك 

بدو يطلع الerd  مرسوم كامل 

منحفظ الerd   ومنسميه اسم بيتعلق بالمشروع ومنحفظ الكويري تبع انشاء الجداول  كمان باسم يتعلق بالمشروع 

انتهى القسم الأول 
